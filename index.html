<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learneasy.uz — Media & AI</title>
</head>
<body style="font-family: 'Segoe UI', sans-serif; background: #0f172a; color: white; margin: 0; overflow-x: hidden;">

    <nav style="display: flex; justify-content: space-between; align-items: center; padding: 15px 25px; background: #1e293b; border-bottom: 1px solid #334155; position: sticky; top: 0; z-index: 100;">
        <h2 style="margin: 0; color: #38bdf8; font-size: 20px;">Learneasy.uz</h2>
        <button id="toggle-btn" onclick="showAI()" style="background: #38bdf8; color: #0f172a; border: none; padding: 10px 18px; border-radius: 10px; font-weight: bold; cursor: pointer;">
            AI Agentga o'tish →
        </button>
    </nav>

    <div id="home-page" style="padding: 20px; max-width: 800px; margin: auto;">
        <h3 style="color: #94a3b8;">Yangi videolar va postlar</h3>
        
        <div style="background: #1e293b; border-radius: 20px; overflow: hidden; margin-bottom: 20px; border: 1px solid #334155;">
            <div style="padding: 15px;">
                <h4 id="post-title" style="margin: 0 0 10px 0;">Darslik: AI bilan ishlash</h4>
                <p id="post-text" style="font-size: 14px; color: #94a3b8;">Bu videoda siz Learneasy platformasidan foydalanishni o'rganasiz.</p>
            </div>
            <div id="video-container" style="width: 100%; aspect-ratio: 16/9; background: #000; display: flex; align-items: center; justify-content: center;">
                <p style="color: #475569;">[Video joyi: Bu yerda video ko'rinadi]</p>
            </div>
        </div>

        <div id="owner-post-tools" style="display: none; background: #1e293b; padding: 15px; border-radius: 12px; border: 1px dashed #38bdf8;">
            <button onclick="updatePost()" style="background: #475569; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">Post va Videoni o'zgartirish</button>
        </div>
    </div>

    <div id="ai-page" style="display: none; padding: 20px; max-width: 500px; margin: auto; animation: fadeIn 0.5s;">
        <div style="background: #1e293b; padding: 20px; border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.5);">
            <div style="text-align: center; margin-bottom: 15px;">
                <h2 style="color: #38bdf8; margin: 0;">AI Agent</h2>
                <p id="rank-display" style="font-size: 11px; color: #94a3b8;">Darajangiz: Foydalanuvchi</p>
            </div>
            <div id="chat" style="height: 300px; overflow-y: auto; background: #0f172a; border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid #334155; font-size: 14px;"></div>
            <div id="input-area" style="display: flex; gap: 10px;">
                <input type="text" id="inp" placeholder="Savol yo'llang..." style="flex: 1; padding: 12px; border: none; border-radius: 10px; background: #334155; color: white; outline: none;">
                <button onclick="ask()" style="background: #38bdf8; border: none; padding: 12px; border-radius: 10px; cursor: pointer;">➤</button>
            </div>
            <div id="payment-area" style="display: none; margin-top: 15px; padding: 15px; background: #450a0a; border-radius: 15px; text-align: center;">
                <p style="font-size: 13px;">Limit tugadi. Premium: 12,000 so'm</p>
                <code>8600 0000 0000 0000</code>
            </div>
        </div>
        <button onclick="showHome()" style="display: block; margin: 20px auto; background: none; border: 1px solid #475569; color: #94a3b8; padding: 8px 15px; border-radius: 8px; cursor: pointer;">← Ortga qaytish</button>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";
        const genAI = new GoogleGenerativeAI("AIzaSyCPuL1daHvCl-XvMPkCzCbZg12yOYbFrMM");

        let stats = JSON.parse(localStorage.getItem('ai_stats')) || { texts: 0, lastTime: Date.now(), rank: 'user' };

        window.showAI = () => {
            document.getElementById('home-page').style.display = 'none';
            document.getElementById('ai-page').style.display = 'block';
            document.getElementById('toggle-btn').style.display = 'none';
        };

        window.showHome = () => {
            document.getElementById('home-page').style.display = 'block';
            document.getElementById('ai-page').style.display = 'none';
            document.getElementById('toggle-btn').style.display = 'block';
        };

        window.ask = async () => {
            const i = document.getElementById('inp');
            const c = document.getElementById('chat');
            const val = i.value.trim();
            if(!val) return;

            if(val === "owner777") { 
                stats.rank = 'owner'; save(); updateUI(); i.value = ""; return; 
            }

            if(stats.rank === 'user' && stats.texts >= 15) {
                document.getElementById('input-area').style.display = 'none';
                document.getElementById('payment-area').style.display = 'block';
                return;
            }

            c.innerHTML += `<div style="text-align: right; margin-bottom: 10px; color: #38bdf8;">Siz: ${val}</div>`;
            i.value = "";

            try {
                const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                const result = await model.generateContent(val);
                c.innerHTML += `<div style="margin-bottom: 15px;"><b>AI:</b> ${result.response.text()}</div>`;
                if(stats.rank === 'user') { stats.texts++; save(); }
            } catch (e) { c.innerHTML += `<div>Xato yuz berdi.</div>`; }
            c.scrollTop = c.scrollHeight;
        };

        window.updatePost = () => {
            const title = prompt("Video sarlavhasi:");
            const text = prompt("Post matni:");
            const vid = prompt("Video linki (YouTube embed link):");
            if(title) document.getElementById('post-title').innerText = title;
            if(text) document.getElementById('post-text').innerText = text;
            if(vid) document.getElementById('video-container').innerHTML = `<iframe width="100%" height="100%" src="${vid}" frameborder="0" allowfullscreen></iframe>`;
        };

        function updateUI() {
            document.getElementById('rank-display').innerText = "Darajangiz: " + stats.rank;
            if(stats.rank === 'owner') document.getElementById('owner-post-tools').style.display = 'block';
        }
        function save() { localStorage.setItem('ai_stats', JSON.stringify(stats)); }
        updateUI();
    </script>

    <style>
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</body>
</html>
