<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <title>Learneasy.uz AI â€” Premium</title>
</head>
<body style="font-family: sans-serif; background: #f0f2f5; padding: 20px; text-align: center;">

    <div style="max-width: 550px; margin: auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.15);">
        <h2 style="color: #007bff;">Learneasy.uz AI</h2>
        <div style="display: flex; justify-content: space-around; margin-bottom: 15px; font-size: 13px; color: #555;">
            <span id="text-limit">Savollar: 15/15</span>
            <span id="img-limit">Rasmlar: 3/3</span>
        </div>
        
        <div id="chat" style="height: 350px; overflow-y: auto; border: 1px solid #f0f0f0; padding: 15px; text-align: left; margin-bottom: 20px; background: #fcfcfc; border-radius: 12px;">
            <div id="welcome-msg" style="background: #eef; padding: 10px; border-radius: 10px;">
                Salom! Sizda 15 ta bepul savol bor. Limit tugasa, 8 soatdan keyin yangilanadi yoki Premium sotib oling.
            </div>
        </div>
        
        <div id="input-area">
            <input type="text" id="inp" placeholder="Savol yozing..." style="width: 70%; padding: 14px; border: 1px solid #ddd; border-radius: 10px;">
            <button onclick="ask()" style="padding: 14px; background: #007bff; color: white; border: none; border-radius: 10px; cursor: pointer;">Yuborish</button>
        </div>

        <div id="payment-area" style="display: none; margin-top: 20px; padding: 20px; background: #fff3cd; border-radius: 15px;">
            <h3 style="color: #856404;">Limit Tugadi! ðŸ›‘</h3>
            <p>8 soat kutishni xohlamasangiz, <b>12,000 so'm</b> to'lang va cheksiz ishlating!</p>
            <p>Karta: <code>8600 0000 0000 0000</code></p>
            <a href="https://t.me/SizningTelegramingiz" target="_blank" style="display: block; padding: 12px; background: #24a1de; color: white; text-decoration: none; border-radius: 10px;">Adminga chekni yuborish</a>
        </div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

        const API_KEY = "AIzaSyCPuL1daHvCl-XvMPkCzCbZg12yOYbFrMM"; 
        const genAI = new GoogleGenerativeAI(API_KEY);

        // Limitlarni yuklash
        let stats = JSON.parse(localStorage.getItem('ai_stats')) || { texts: 0, imgs: 0, lastTime: Date.now(), isPremium: false };

        // 8 soat o'tganini tekshirish (8 soat = 28800000 millisoniya)
        if (!stats.isPremium && Date.now() - stats.lastTime > 28800000) {
            stats.texts = 0;
            stats.imgs = 0;
            stats.lastTime = Date.now();
            localStorage.setItem('ai_stats', JSON.stringify(stats));
        }

        updateUI();

        window.ask = async () => {
            const i = document.getElementById('inp');
            const c = document.getElementById('chat');
            const text = i.value.trim();
            if(!text) return;

            // Admin rejimi (Parol yozilganda premium yoqiladi)
            if(text.toLowerCase() === "admin777") {
                stats.isPremium = true;
                saveStats();
                updateUI();
                c.innerHTML += `<div style="color: green;">âœ“ Premium rejimi faollashdi!</div>`;
                i.value = ""; return;
            }

            const isImg = text.toLowerCase().includes("rasm") || text.toLowerCase().includes("chiz");
            
            if(!stats.isPremium) {
                if(!isImg && stats.texts >= 15) { showPay(); return; }
                if(isImg && stats.imgs >= 3) { showPay(); return; }
            }

            c.innerHTML += `<div style="text-align: right;"><b>Siz:</b> ${text}</div>`;
            i.value = "";

            try {
                const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                const result = await model.generateContent(text);
                c.innerHTML += `<div><b>AI:</b> ${result.response.text()}</div>`;
                
                if(!stats.isPremium) {
                    if(isImg) stats.imgs++; else stats.texts++;
                    saveStats();
                    updateUI();
                }
            } catch (err) {
                c.innerHTML += `<div style="color: red;">Xato: API ulanmadi.</div>`;
            }
            c.scrollTop = c.scrollHeight;
        };

        function saveStats() { localStorage.setItem('ai_stats', JSON.stringify(stats)); }
        
        function updateUI() {
            if(stats.isPremium) {
                document.getElementById('text-limit').innerText = "Savollar: Cheksiz";
                document.getElementById('img-limit').innerText = "Rasmlar: Cheksiz";
            } else {
                document.getElementById('text-limit').innerText = `Savollar: ${15 - stats.texts}/15`;
                document.getElementById('img-limit').innerText = `Rasmlar: ${3 - stats.imgs}/3`;
            }
        }

        function showPay() {
            document.getElementById('input-area').style.display = 'none';
            document.getElementById('payment-area').style.display = 'block';
        }
    </script>
</body>
</html>
