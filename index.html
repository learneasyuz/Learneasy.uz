<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learneasy.uz AI â€” Premium System</title>
</head>
<body style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f172a; color: white; padding: 20px; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh;">

    <div style="width: 100%; max-width: 500px; background: #1e293b; padding: 25px; border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); border: 1px solid #334155;">
        
        <div style="text-align: center; margin-bottom: 20px;">
            <h2 style="color: #38bdf8; margin: 0; font-size: 24px;">Learneasy.uz AI</h2>
            <p id="rank-display" style="font-size: 12px; color: #94a3b8; margin-top: 5px; text-transform: uppercase; letter-spacing: 1px;">Darajangiz: Foydalanuvchi</p>
        </div>
        
        <div id="news-board" style="background: rgba(56, 189, 248, 0.1); padding: 12px; border-radius: 12px; margin-bottom: 15px; font-size: 13px; border-left: 4px solid #38bdf8; color: #e2e8f0; line-height: 1.5;">
            <b>E'lon:</b> Xush kelibsiz! Savollaringizni yo'llang. 15 ta bepul imkoniyat mavjud.
        </div>

        <div id="chat" style="height: 350px; overflow-y: auto; padding: 10px; margin-bottom: 20px; background: #0f172a; border-radius: 16px; border: 1px solid #334155; font-size: 14px; scroll-behavior: smooth;">
            <div style="color: #94a3b8; text-align: center; margin-top: 150px;">Suhbatni boshlash uchun savol yozing...</div>
        </div>
        
        <div id="input-area" style="display: flex; gap: 10px;">
            <input type="text" id="inp" placeholder="Savol yo'llang..." style="flex: 1; padding: 14px; border: none; border-radius: 12px; background: #334155; color: white; outline: none; border: 1px solid #475569;">
            <button onclick="ask()" style="padding: 14px 20px; background: #38bdf8; color: #0f172a; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; transition: 0.3s;">
                âž¤
            </button>
        </div>

        <div id="owner-tools" style="display: none; margin-top: 20px; border-top: 1px dashed #475569; padding-top: 15px; text-align: center;">
            <p style="color: #fbbf24; font-size: 13px; margin-bottom: 10px;">ðŸ›  Super Admin Paneli</p>
            <button onclick="changeNews()" style="background: #475569; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 12px;">E'lonni o'zgartirish</button>
        </div>

        <div id="payment-area" style="display: none; margin-top: 10px; padding: 20px; background: #450a0a; border-radius: 18px; border: 1px solid #991b1b; text-align: center;">
            <h3 style="color: #fca5a5; margin: 0 0 10px 0;">Limit Tugadi! ðŸ›‘</h3>
            <p style="font-size: 13px; color: #fecaca;">8 soat kutish yoki <b>12,000 so'm</b> evaziga cheksiz paketni faollashtiring.</p>
            <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px; margin: 15px 0;">
                <code style="font-size: 16px; color: #38bdf8;">8600 0000 0000 0000</code>
            </div>
            <a href="https://t.me/SizningTelegramingiz" target="_blank" style="display: inline-block; padding: 10px 20px; background: #24a1de; color: white; text-decoration: none; border-radius: 10px; font-weight: bold; font-size: 13px;">Adminga chek yuborish</a>
        </div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

        const API_KEY = "AIzaSyCPuL1daHvCl-XvMPkCzCbZg12yOYbFrMM"; 
        const genAI = new GoogleGenerativeAI(API_KEY);

        let stats = JSON.parse(localStorage.getItem('ai_stats')) || { texts: 0, lastTime: Date.now(), rank: 'user' };

        // 8 soatlik limitni yangilash
        if (stats.rank === 'user' && Date.now() - stats.lastTime > 28800000) {
            stats.texts = 0; 
            stats.lastTime = Date.now();
            save();
        }

        function updateUI() {
            const rankMap = { 'owner': 'Super Admin (Ega)', 'admin': 'Admin (Premium)', 'user': 'Foydalanuvchi' };
            document.getElementById('rank-display').innerText = "Darajangiz: " + rankMap[stats.rank];
            if(stats.rank === 'owner') document.getElementById('owner-tools').style.display = 'block';
        }
        updateUI();

        window.ask = async () => {
            const i = document.getElementById('inp');
            const c = document.getElementById('chat');
            const val = i.value.trim();
            if(!val) return;

            // Parollar
            if(val === "owner777") { stats.rank = 'owner'; save(); updateUI(); i.value = ""; c.innerHTML = ""; return; }
            if(val === "admin123") { stats.rank = 'admin'; save(); updateUI(); i.value = ""; return; }

            // Limit tekshiruvi
            if(stats.rank === 'user' && stats.texts >= 15) {
                document.getElementById('input-area').style.display = 'none';
                document.getElementById('payment-area').style.display = 'block';
                return;
            }

            if(c.innerHTML.includes("Suhbatni boshlash")) c.innerHTML = "";
            c.innerHTML += `<div style="text-align: right; margin-bottom: 15px;"><span style="background: #38bdf8; color: #0f172a; padding: 10px 15px; border-radius: 15px 15px 0 15px; display: inline-block; max-width: 80%; line-height: 1.4;">${val}</span></div>`;
            i.value = "";

            try {
                const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                const result = await model.generateContent(val);
                const response = result.response.text();
                
                c.innerHTML += `<div style="margin-bottom: 15px; line-height: 1.6; color: #e2e8f0;"><b>AI:</b> ${response}</div>`;
                if(stats.rank === 'user') { stats.texts++; save(); }
            } catch (e) {
                c.innerHTML += `<div style="color: #ef4444; font-size: 12px;">Xatolik: Tarmoq bilan ulanishda muammo.</div>`;
            }
            c.scrollTop = c.scrollHeight;
        };

        window.changeNews = () => {
            const n = prompt("Yangi e'lon matnini yozing:");
            if(n) {
                document.getElementById('news-board').innerHTML = `<b>E'lon:</b> ${n}`;
            }
        };

        function save() { localStorage.setItem('ai_stats', JSON.stringify(stats)); }
    </script>
</body>
</html>
